<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Identify faces</title>
    <script src="https://unpkg.com/hyperhtml@latest/min.js"></script>
    <style>
      {% include 'style.jinja.css' %}
    </style>
    <script>
      const getCoords = x => { 
        const [top,right,bottom,left] = x.dataset.coord.replace(/[ ()]/g,'').split(',').map(Number)
        return {top,right,bottom,left}
    }
    const markFaces = () => {
      const facesDom = document.querySelector('.crop-face')
      const pos = getCoords(facesDom)
      console.log(pos)
      hyperHTML.bind(facesDom)`<div class='face-square' style=${ { top:pos.top, left:pos.left } } ></div>`
      return facesDom
    }
    </script>
  </head>
  <body>
    <main class="grid-container">
      {% for (url, (top, right, bottom, left), face_id) in images %}
      {# Faces are square, so we can calculate just one side #}
      {% set face_size =  right - left %}
      {% set offset = ( crop_size - face_size)/2 | abs  %}
      {% set left_x = [ left - offset - 2, 0] | max %}
      {% set top_y = [ top - offset - 2, 0 ] | max %}
      <div class="crop-wrapper">
        <div
          data-coord="{{(top, right, bottom, left)}}"
          class="crop-face"
          style="
            background-image: url('{{ url }}');
            background-position-x: {{ [ left_x, 100 ] | min}}%;
            background-position-y: {{ [ top_y, 100 ]| min }}%;
          "
        >
        </div>
        <div class="info">face id:{{ face_id }}</div>
      </div>
      {% endfor %}
    </main>
  </body>
</html>
